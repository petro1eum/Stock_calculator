# Рефакторинг InventoryCalculator

## Обзор

Основной файл `InventoryCalculator.tsx` был разбит на множество модулей для улучшения поддерживаемости и читаемости кода. Исходный файл содержал более 2300 строк кода, теперь основной компонент содержит около 550 строк.

## Структура проекта после рефакторинга

```
src/
├── types/
│   └── index.ts              # Все TypeScript интерфейсы и типы
├── utils/
│   ├── mathFunctions.ts      # Математические функции (CDF, Black-Scholes)
│   └── inventoryCalculations.ts # Функции расчета запасов
├── components/
│   ├── Dashboard.tsx         # Компонент дашборда
│   ├── SimpleLayout.tsx      # Компонент layout
│   ├── SliderWithValue.tsx   # Компонент слайдера с полем ввода
│   ├── TheoryTab.tsx         # Вкладка "Теория"
│   └── SettingsTab.tsx       # Вкладка "Настройки"
└── InventoryCalculator.tsx   # Основной компонент (рефакторенный)
```

## Основные изменения

### 1. Выделение типов (types/index.ts)
- Все интерфейсы вынесены в отдельный файл
- Добавлен новый интерфейс `MonteCarloParams`
- Экспортируются: `ChartPoint`, `Product`, `ProductWithCategory`, `Scenario`, `VolumeDiscount`, `SeasonalityData`, `SliderWithValueProps`

### 2. Математические функции (utils/mathFunctions.ts)
- `normalCDF` - функция нормального распределения
- `inverseNormal` - обратная функция нормального распределения
- `blackScholesCall` - расчет стоимости колл-опциона
- `formatNumber` - форматирование чисел

### 3. Функции расчета запасов (utils/inventoryCalculations.ts)
- `mcDemandLoss` - Monte Carlo симуляция потерянных продаж
- `getEffectivePurchasePrice` - расчет цены с учетом скидок
- `calculateExpectedRevenue` - расчет ожидаемой выручки
- `calculateVolatility` - расчет волатильности
- `getSeasonalDemand` - расчет спроса с учетом сезонности
- `getAverageSeasonalDemand` - средний сезонный спрос

### 4. Компоненты UI
- `SliderWithValue` - переиспользуемый компонент слайдера
- `TheoryTab` - вкладка с теорией Black-Scholes
- `SettingsTab` - вкладка с настройками модели

### 5. Улучшения в основном файле
- Удалены все дублированные определения функций
- Использованы импорты из модулей
- Добавлены обертки для функций с параметрами Monte Carlo
- Улучшена типизация

## Новые функции добавленные во время рефакторинга

1. **Текущие запасы**: Возможность указать количество товара на складе
2. **Сезонность**: Настройка коэффициентов спроса по месяцам
3. **Настраиваемые параметры Monte Carlo**: Количество итераций, seed для воспроизводимости

## Преимущества рефакторинга

1. **Модульность**: Каждый модуль имеет свою зону ответственности
2. **Переиспользование**: Компоненты и функции можно использовать в других частях приложения
3. **Тестируемость**: Чистые функции легко тестировать
4. **Читаемость**: Основной файл стал намного меньше и понятнее
5. **Поддерживаемость**: Изменения в логике расчетов не затрагивают UI и наоборот

## Дальнейшие улучшения

1. Создать компоненты для остальных вкладок (Ассортимент, Анализ товара, Экспорт/Импорт)
2. Добавить unit тесты для математических функций
3. Создать хуки для управления состоянием (useProducts, useOptimization)
4. Добавить интернационализацию (i18n)
5. Оптимизировать производительность с помощью React.memo и useMemo 